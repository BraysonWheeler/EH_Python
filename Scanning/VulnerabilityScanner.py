#!/usr/bin/python3

import socket
import os       # allows us to check if fle exist
import sys      # number of arguments ./vulscan.py vulbanners.txt<---- want it to read the .txt file





def retBanner(ip,port):
    try:

        socket.setdefaulttimeout(2)
        sock = socket.socket()
        sock.connect((ip,port))
        i = sock.recv(1024) #recieving 1024 bytes
        return i

    except:
        return

def checkVuln(banner,filename):
    f = open(filename, "r")     #open(.txt, "read")
    for line in f.readlines():
        if line.strip("\n") in banner:
            print ("Server is vulnerable : %s"% (banner.strip("\n")))






def main():
    # check for correct number of arguments 2 in this program
    if len(sys.argv) == 2:
        filename = sys.argv[1]
        if not os.path.isfile(filename):
            print ("FILE DOESNT EXITS")
            exit(0)
        if not os.access(filename, os.R_OK):
            print("ACCESS DENIED NEED HIGH PRIV")
            exit(0)

    else:
        print ("Usage: %s [vuln filename]" % (str(sys.argv[0])))
        exit(0)

    #scan all local network
    portlist = [21,22,25,80,110,443,445]

    #ip addr ending in 3 4 5 if wanted entire local network use (1,225)
    for i in range(3,6):
        ip = "192.168.1." + str(i)
        for port in portlist:
            banner = retBanner(ip,port)
            if banner:
                print ("%s/%d : %s" % (ip,port,banner))
                checkVuln(banner,filename)
if __name__== "__main__":
    main()
